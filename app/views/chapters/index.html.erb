<% provide :title, @query.nil? ? "Table of contents" : "Lessons containing '#{@query}'" %>

<h1><%= yield :title %></h1>

<%= render 'lessons/search' %>

<ul class='chapter'>
  <% @chapters.each do |chapter| %>
    <li class='chapter'>
      <a class='chapter'><%= chapter.name %></a>
      <% if can? :update, Chapter %>
        <%= link_to "(edit)", edit_chapter_path(chapter), :id => "edit_chapter_#{chapter.id}" %>
      <% end %>
      <ul class='section'>
        <% chapter.sections.each do |section| %>
          <li class='section'>
            <a class='section'><%= section.name %></a>
            <% if can? :update, Section %>
              <%= link_to "(edit)", edit_section_path(section), :id => "edit_section_#{section.id}" %>
            <% end %>
            <ul class='lesson'>
              <% section.lessons.each do |lesson| %>
                <li><%= link_to lesson.name, lesson, :class => 'lesson' %></li>
              <% end %>
            </ul>
          </li>
        <% end %>
      </ul>
    </li>
  <% end%>
</ul>

<% if can? :create, Chapter %>
  <p><%= link_to 'New chapter', new_chapter_path, :class => "btn btn-primary btn-large"%>
<% end%>

<% if can? :create, Section %>
  <p><%= link_to 'New section', new_section_path, :class => "btn btn-warning btn-large" %></p>
<% end %>

<% if can? :create, Lesson %>
  <p><%= link_to 'New lesson', new_lesson_path, :class => "btn btn-success btn-large" %></p>
<% end %>
